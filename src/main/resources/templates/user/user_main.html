<!DOCTYPE HTML>
<html lang="pl" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleafextras-springsecurity6">
<head>
    <meta charset="UTF-8"/>
    <title>Panel Klienta - Armator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link th:rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="icon" type="image/png" th:href="@{/assets.img/anchor.png}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark navbar-custom static-top">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="bi bi-rudder"></i> Panel Klienta
        </a>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto align-items-center">
                <li class="nav-item me-3 text-white">
                    Zalogowany: <strong sec:authentication="principal.username" class="text-info"></strong>
                </li>
                <li class="nav-item">
                    <form th:action="@{/logout}" method="post">
                        <button class="btn btn-sm btn-outline-light" type="submit">Wyloguj</button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h3 style="color: var(--light); font-weight: 700;">Pulpit Logistyczny</h3>
            <p style="color: var(--accent); opacity: 0.8;">Przegldaj swoje zlecenia frachtowe i dostpn flot.</p>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card bg-primary text-white p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-0 text-white-50">Twoje aktywne zlecenia</h6>
                        <h2 class="mb-0 fw-bold" th:text="${listLadunki.size()}">0</h2>
                    </div>
                    <div class="fs-1 opacity-25"><i class="bi bi-box-seam"></i></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-success text-white p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-0 text-white-50">czna waga towaru (t)</h6>
                        <h2 class="mb-0 fw-bold" th:text="${#numbers.formatDecimal(sumaWagi, 1, 1)}">0.0</h2>
                    </div>
                    <div class="fs-1 opacity-25"><i class="bi bi-speedometer2"></i></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-info text-white p-3 shadow-sm h-100" style="background-color: #17a2b8 !important;">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-0 text-white-50">Dostpna flota statk贸w</h6>
                        <h2 class="mb-0 fw-bold" th:text="${listStatek.size()}">0</h2>
                    </div>
                    <div class="fs-1 opacity-25"><i class="bi bi-tsunami"></i></div>
                </div>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active fw-bold" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders" type="button" role="tab"> Moje adunki</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-bold" id="fleet-tab" data-bs-toggle="tab" data-bs-target="#fleet" type="button" role="tab"> Katalog Statk贸w</button>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">

        <div class="tab-pane fade show active" id="orders" role="tabpanel">
            <div class="card card-custom">
                <div class="card-header card-header-custom d-flex justify-content-between align-items-center">
                    <span>Rejestr Zleconych adunk贸w</span>
                    <span class="badge bg-light text-dark" th:text="${listLadunki.size()} + ' aktywnych'">0 aktywnych</span>
                </div>
                <div class="card-body p-0">
                    <div th:if="${#lists.isEmpty(listLadunki)}" class="p-5 text-center text-muted">
                        <h5>Brak zarejestrowanych adunk贸w.</h5>
                        <p>Przejd藕 do zakadki "Katalog Statk贸w", aby zleci transport.</p>
                    </div>
                    <div class="table-responsive" th:unless="${#lists.isEmpty(listLadunki)}">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                            <tr>
                                <th>Nr adunku</th>
                                <th>Waga (t)</th>
                                <th>ID Rejsu</th>
                                <th>Typ adunku (ID)</th>
                                <th class="text-end pe-4">Akcje</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="ladunek : ${listLadunki}">
                                <td class="fw-bold text-primary" th:text="'#' + ${ladunek.nr_ladunku}">ID</td>
                                <td th:text="${ladunek.waga_w_tonach}">Waga</td>
                                <td th:text="${ladunek.nr_rejsu}">Rejs</td>
                                <td th:text="${ladunek.nr_typu_ladunku}">Typ</td>
                                <td class="text-end pe-4">
                                    <a class="btn btn-outline-danger btn-sm"
                                       th:href="@{'/delete_ladunek/' + ${ladunek.nr_ladunku}}"
                                       onclick="return confirm('Czy na pewno chcesz wycofa to zlecenie? Operacji nie mo偶na cofn.');">
                                        <i class="bi bi-trash3-fill"></i> Wycofaj
                                    </a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="fleet" role="tabpanel">
            <div class="card card-custom">
                <div class="card-header bg-white border-bottom">
                    <h5 class="mb-0 text-muted">Dostpne jednostki transportowe</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped mb-0">
                            <thead class="table-dark">
                            <tr>
                                <th>Nazwa Statku</th>
                                <th>Bandera</th>
                                <th>Rok Budowy</th>
                                <th>Tona偶 (DWT)</th>
                                <th>Akcja</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="statek : ${listStatek}">
                                <td th:text="${statek.nazwa_statku}" class="fw-bold">Nazwa</td>
                                <td th:text="${statek.bandera}">Kraj</td>
                                <td th:text="${statek.rok_budowy}">Rok</td>
                                <td th:text="${statek.tonaz}">Tona偶</td>
                                <td>
                                    <button type="button" class="btn btn-primary-custom btn-sm" data-bs-toggle="modal" data-bs-target="#orderModal">
                                        Zle transport
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="text-center mt-5 text-muted small">
    &copy; 2026 System Zarzdzania Flot Armator
</div>

<div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="orderModalLabel">Nowe Zlecenie Transportowe</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form th:action="@{/save_ladunek}" th:object="${ladunek}" method="post">

                    <div class="mb-3">
                        <label class="form-label">Waga adunku (tony)</label>
                        <input type="number" step="0.1" class="form-control" th:field="*{waga_w_tonach}" required placeholder="Np. 150.5">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Rodzaj adunku</label>
                        <select class="form-select" th:field="*{nr_typu_ladunku}" required>
                            <option value="" disabled selected>Wybierz typ z listy...</option>
                            <option th:each="typ : ${listTypow}"
                                    th:value="${typ.nr_typu_ladunku}"
                                    th:text="${typ.nazwa_typu}">
                            </option>
                        </select>
                    </div>

                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn btn-primary-custom">Zatwierd藕 Zlecenie</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

</body>
</html>